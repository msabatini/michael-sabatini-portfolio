<div class="dashboard-container fade-in-animation">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Admin Dashboard</h1>
        <nav class="dashboard-tabs">
          <button 
            [class.active]="activeTab() === 'analytics'" 
            (click)="setTab('analytics')">
            <app-icon name="chart" [size]="18"></app-icon>
            Analytics
          </button>
          <button 
            [class.active]="activeTab() === 'projects'" 
            (click)="setTab('projects')">
            <app-icon name="briefcase" [size]="18"></app-icon>
            Projects
          </button>
          <button 
            [class.active]="activeTab() === 'messages'" 
            (click)="setTab('messages')">
            <app-icon name="mail" [size]="18"></app-icon>
            Messages
            @if (unreadCount() > 0) {
              <span class="tab-badge">{{ unreadCount() }}</span>
            }
          </button>
          <button 
            [class.active]="activeTab() === 'settings'" 
            (click)="setTab('settings')">
            <app-icon name="settings" [size]="18"></app-icon>
            Settings
          </button>
          <button 
            [class.active]="activeTab() === 'media'" 
            (click)="setTab('media')">
            <app-icon name="image" [size]="18"></app-icon>
            Media
          </button>
        </nav>
      </div>
      <div class="header-actions">
        @if (activeTab() === 'analytics') {
          <button (click)="loadStats()" class="btn btn-outline btn-sm">Refresh</button>
        } @else if (activeTab() === 'projects') {
          <button (click)="openForm()" class="btn btn-primary btn-sm">
            <app-icon name="plus" [size]="16"></app-icon>
            New Project
          </button>
        } @else if (activeTab() === 'messages') {
          <button (click)="loadMessages()" class="btn btn-outline btn-sm">Refresh</button>
        } @else if (activeTab() === 'media') {
          <label class="btn btn-primary btn-sm" style="cursor: pointer;">
            <app-icon name="upload" [size]="16"></app-icon>
            Upload Media
            <input type="file" (change)="onFileUpload($event)" style="display: none;" accept="image/*">
          </label>
        } @else {
          <button (click)="saveSettings()" class="btn btn-primary btn-sm">
            <app-icon name="save" [size]="16"></app-icon>
            Save Settings
          </button>
        }
        <button (click)="logout()" class="btn btn-outline btn-sm">Logout</button>
      </div>
    </div>
  </header>

  <div class="dashboard-content">
    @if (activeTab() === 'analytics') {
      <div class="analytics-controls data-table-card">
        <div class="control-group">
          <label>Date Range</label>
          <div class="presets">
            <button (click)="setDatePreset(0)" class="btn btn-xs" [class.active]="dateRange().start === dateRange().end">Today</button>
            <button (click)="setDatePreset(7)" class="btn btn-xs">7d</button>
            <button (click)="setDatePreset(30)" class="btn btn-xs">30d</button>
          </div>
          <div class="date-inputs">
            <input type="date" [value]="dateRange().start" (change)="updateDateRange($any($event.target).value, dateRange().end)">
            <span>to</span>
            <input type="date" [value]="dateRange().end" (change)="updateDateRange(dateRange().start, $any($event.target).value)">
          </div>
        </div>
        <div class="control-group">
          <label>Device</label>
          <select (change)="updateFilter('device', $any($event.target).value)">
            <option value="">All</option>
            <option value="Desktop">Desktop</option>
            <option value="Mobile">Mobile</option>
            <option value="Tablet">Tablet</option>
          </select>
        </div>
        <div class="control-group">
          <label>Campaign</label>
          <select (change)="updateFilter('campaign', $any($event.target).value)">
            <option value="">All</option>
            @for (utm of stats()?.utmStats; track utm.campaign) {
              @if (utm.campaign) {
                <option [value]="utm.campaign">{{ utm.campaign }}</option>
              }
            }
          </select>
        </div>
        <div class="control-group">
          <label>Location</label>
          <select (change)="updateFilter('location', $any($event.target).value)">
            <option value="">All</option>
            @for (loc of stats()?.locationStats; track loc.name) {
              <option [value]="loc.name">{{ loc.name }}</option>
            }
          </select>
        </div>
        <div class="control-actions">
          <button (click)="exportPDF()" class="btn btn-outline btn-sm">
            <app-icon name="file-text" [size]="14"></app-icon> PDF Report
          </button>
          <button (click)="downloadCSV('pages')" class="btn btn-outline btn-sm">
            <app-icon name="download" [size]="14"></app-icon> Export CSV
          </button>
        </div>
      </div>

      @if (analyticsFilters().path) {
        <div class="active-filters">
          <span class="filter-tag">
            Path: {{ analyticsFilters().path }}
            <button (click)="updateFilter('path', '')"><app-icon name="x" [size]="12"></app-icon></button>
          </span>
        </div>
      }

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Views</h3>
          <p class="stat-value">{{ stats()?.totalViews || 0 }}</p>
          <span class="stat-label">Pageviews</span>
        </div>
        <div class="stat-card">
          <h3>Unique Visitors</h3>
          <p class="stat-value">{{ stats()?.uniqueVisitors || 0 }}</p>
          <span class="stat-label">Visitors</span>
        </div>
        <div class="stat-card">
          <h3>Bounce Rate</h3>
          <p class="stat-value">{{ stats()?.engagementMetrics?.bounceRate || 0 }}%</p>
          <span class="stat-label">Single page sessions</span>
        </div>
        <div class="stat-card">
          <h3>Engagement</h3>
          <p class="stat-value">{{ stats()?.engagementMetrics?.engagementRate || 0 }}%</p>
          <span class="stat-label">Engaged sessions</span>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Sessions</h3>
          <p class="stat-value">{{ stats()?.trafficMetrics?.totalSessions || 0 }}</p>
          <span class="stat-label">{{ stats()?.trafficMetrics?.sessionsPerUser || 0 }} per user</span>
        </div>
        <div class="stat-card">
          <h3>Avg. Session</h3>
          <p class="stat-value">{{ stats()?.avgSessionDuration || '0:00' }}</p>
          <span class="stat-label">{{ stats()?.trafficMetrics?.pagesPerSession || 0 }} pages/session</span>
        </div>
        <div class="stat-card">
          <h3>Top Scroll</h3>
          <p class="stat-value">75%</p>
          <span class="stat-label">Avg. scroll depth</span>
        </div>
        <div class="stat-card">
          <h3>Interactions</h3>
          <p class="stat-value">{{ stats()?.interactions?.length || 0 }}</p>
          <span class="stat-label">Unique events</span>
        </div>
      </div>

      <div class="stats-sections secondary-stats">
        <div class="data-table-card">
          <h2>Core Web Vitals</h2>
          <div class="vitals-grid">
            <div class="vital-item" [class]="getVitalsScore('lcp', stats()?.performanceMetrics?.lcp)">
              <span class="label">LCP</span>
              <span class="value">{{ stats()?.performanceMetrics?.lcp || 0 }}ms</span>
            </div>
            <div class="vital-item" [class]="getVitalsScore('fid', stats()?.performanceMetrics?.fid)">
              <span class="label">FID</span>
              <span class="value">{{ stats()?.performanceMetrics?.fid || 0 }}ms</span>
            </div>
            <div class="vital-item" [class]="getVitalsScore('cls', stats()?.performanceMetrics?.cls)">
              <span class="label">CLS</span>
              <span class="value">{{ stats()?.performanceMetrics?.cls || 0 }}</span>
            </div>
            <div class="vital-item">
              <span class="label">TTFB</span>
              <span class="value">{{ stats()?.performanceMetrics?.ttfb || 0 }}ms</span>
            </div>
          </div>
          <div class="stat-card mini" style="margin-top: 1rem; box-shadow: none;">
            <h3>Avg. Load Time</h3>
            <p class="stat-value" style="font-size: 1.5rem;">{{ (stats()?.performanceMetrics?.load_time / 1000).toFixed(2) }}s</p>
          </div>
        </div>

        <div class="data-table-card">
          <h2>Tech Breakdown</h2>
          <div class="tech-grid">
            <div class="tech-section">
              <h3>Operating System</h3>
              @for (os of stats()?.techBreakdown?.os; track os.name) {
                <div class="tech-item">
                  <span>{{ os.name }}</span>
                  <span>{{ os.count }}</span>
                </div>
              }
            </div>
            <div class="tech-section">
              <h3>Resolution</h3>
              @for (res of stats()?.techBreakdown?.resolution; track res.name) {
                <div class="tech-item">
                  <span>{{ res.name }}</span>
                  <span>{{ res.count }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <div class="stats-sections secondary-stats">
        <div class="data-table-card">
          <h2>User Flows (Top Sequences)</h2>
          <div class="flow-list">
            @for (flow of stats()?.uxMetrics?.topFlows; track flow.flow) {
              <div class="flow-item">
                <div class="flow-path">{{ flow.flow }}</div>
                <div class="flow-count">{{ flow.count }} sessions</div>
              </div>
            }
          </div>
        </div>

        <div class="data-table-card">
          <h2>UX Frustration (Rage Clicks)</h2>
          @if (stats()?.uxMetrics?.rageClicks?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Element</th>
                  <th>Page</th>
                  <th>Count</th>
                </tr>
              </thead>
              <tbody>
                @for (rage of stats()?.uxMetrics?.rageClicks; track rage.element) {
                  <tr>
                    <td><span class="status-badge error">{{ rage.element }}</span></td>
                    <td>{{ rage.path }}</td>
                    <td>{{ rage.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No rage clicks detected</div>
          }
        </div>
      </div>

      @if (stats()?.errorMetrics?.length > 0) {
        <div class="data-table-card error-log">
          <h2>Error Log (Recent)</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Message</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              @for (error of stats()?.errorMetrics; track error.message) {
                <tr>
                  <td><span class="status-badge error">{{ error.type.replace('error_', '') }}</span></td>
                  <td class="error-msg-cell">{{ error.message }}</td>
                  <td>{{ error.count }}</td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }

      <div class="stats-sections secondary-stats">
        <div class="data-table-card">
          <h2>Acquisition Channels</h2>
          <div class="channel-stats">
            @for (source of stats()?.acquisitionSources; track source.name) {
              @if (source.count > 0) {
                <div class="channel-item">
                  <div class="channel-info">
                    <span class="channel-name">{{ source.name }}</span>
                    <span class="channel-value">{{ source.count }}</span>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="(source.count / stats()?.totalViews) * 100"></div>
                  </div>
                </div>
              }
            }
          </div>
        </div>

        <div class="data-table-card">
          <h2>New vs Returning</h2>
          <div class="user-split">
            <div class="split-item">
              <span class="label">New Visitors</span>
              <span class="value">{{ stats()?.trafficMetrics?.newUsers || 0 }}</span>
              <div class="progress-bar mini">
                <div class="progress-fill new" [style.width.%]="(stats()?.trafficMetrics?.newUsers / stats()?.uniqueVisitors) * 100"></div>
              </div>
            </div>
            <div class="split-item">
              <span class="label">Returning</span>
              <span class="value">{{ stats()?.trafficMetrics?.returningUsers || 0 }}</span>
              <div class="progress-bar mini">
                <div class="progress-fill returning" [style.width.%]="(stats()?.trafficMetrics?.returningUsers / stats()?.uniqueVisitors) * 100"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="data-table-card">
          <h2>Scroll Depth</h2>
          <div class="scroll-stats">
            @for (depth of [25, 50, 75, 100]; track depth) {
              <div class="scroll-item">
                <span class="label">{{ depth }}% Depth</span>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="getScrollPercent(depth)"></div>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="data-table-card">
          <h2>Exit Pages</h2>
          @if (stats()?.engagementMetrics?.exitStats?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Page</th>
                  <th>Exits</th>
                  <th>Exit Rate</th>
                </tr>
              </thead>
              <tbody>
                @for (exit of stats()?.engagementMetrics?.exitStats; track exit.path) {
                  <tr>
                    <td>{{ exit.path }}</td>
                    <td>{{ exit.count }}</td>
                    <td>{{ exit.rate }}%</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No exit data yet</div>
          }
        </div>
      </div>

      <div class="chart-section data-table-card">
        <h2>7-Day Activity</h2>
        @if (stats()?.dailyActivity?.length > 0) {
          <div class="bar-chart">
            @for (day of stats()?.dailyActivity; track day.date) {
              <div class="bar-group">
                <div class="bar-container">
                  <div class="bar" 
                    [style.height.%]="(day.count / getMaxActivity()) * 100"
                    [attr.title]="day.count + ' views'">
                    <span class="bar-tooltip">{{ day.count }}</span>
                  </div>
                </div>
                <span class="bar-label">{{ day.date }}</span>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">No activity data yet</div>
        }
      </div>

      <div class="stats-sections">
        <div class="data-table-card">
          <h2>Top Pages</h2>
          @if (stats()?.topPages?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Page Path</th>
                  <th>Views</th>
                  <th style="width: 150px;">Popularity</th>
                </tr>
              </thead>
              <tbody>
                @for (page of stats()?.topPages; track page.path) {
                  <tr>
                    <td>
                      <a href="javascript:void(0)" (click)="updateFilter('path', page.path)" class="drill-down-link">
                        {{ page.path }}
                      </a>
                    </td>
                    <td>{{ page.count }}</td>
                    <td>
                      <div class="progress-bar">
                        <div class="progress-fill" [style.width.%]="(page.count / stats()?.totalViews) * 100"></div>
                      </div>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No page data yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Project Engagement</h2>
          @if (stats()?.topProjects?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Project</th>
                  <th>Views</th>
                </tr>
              </thead>
              <tbody>
                @for (project of stats()?.topProjects; track project.path) {
                  <tr>
                    <td>
                      <a href="javascript:void(0)" (click)="updateFilter('path', project.path)" class="drill-down-link">
                        {{ project.path.replace('/projects/', '') || 'All' }}
                      </a>
                    </td>
                    <td>{{ project.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No project views yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Top Referrers</h2>
          @if (stats()?.topReferrers?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Source</th>
                  <th>Views</th>
                </tr>
              </thead>
              <tbody>
                @for (ref of stats()?.topReferrers; track ref.referrer) {
                  <tr>
                    <td>{{ ref.referrer }}</td>
                    <td>{{ ref.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No referrer data yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Top Locations</h2>
          @if (stats()?.locationStats?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>City / Country</th>
                  <th>Visitors</th>
                </tr>
              </thead>
              <tbody>
                @for (loc of stats()?.locationStats; track loc.name) {
                  <tr>
                    <td>{{ loc.name }}</td>
                    <td>{{ loc.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No location data yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Browser Usage</h2>
          @if (stats()?.browsers?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Browser</th>
                  <th>Count</th>
                </tr>
              </thead>
              <tbody>
                @for (browser of stats()?.browsers; track browser.name) {
                  <tr>
                    <td>{{ browser.name }}</td>
                    <td>{{ browser.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No browser data yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Device Usage</h2>
          <div class="device-stats">
            @if (stats()?.deviceStats?.length > 0) {
              @for (device of stats()?.deviceStats; track device.name) {
                <div class="device-item">
                  <app-icon [name]="device.name === 'Desktop' ? 'monitor' : (device.name === 'Mobile' ? 'smartphone' : 'tablet')" [size]="20"></app-icon>
                  <div class="device-info">
                    <span class="device-name">{{ device.name || 'Unknown' }}</span>
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="(device.count / stats()?.totalViews) * 100"></div>
                    </div>
                  </div>
                  <span class="device-value">{{ ((device.count / stats()?.totalViews) * 100).toFixed(0) }}%</span>
                </div>
              }
            } @else {
              <div class="empty-state">No device data yet</div>
            }
          </div>
        </div>

        <div class="data-table-card">
          <div class="card-header">
            <h2>Campaign Traffic (UTM)</h2>
            <button (click)="downloadCSV('utm')" class="icon-btn" title="Download CSV">
              <app-icon name="download" [size]="14"></app-icon>
            </button>
          </div>
          @if (stats()?.utmStats?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Campaign</th>
                  <th>Source / Medium</th>
                  <th>Views</th>
                </tr>
              </thead>
              <tbody>
                @for (utm of stats()?.utmStats; track $index) {
                  <tr>
                    <td>{{ utm.campaign || 'None' }}</td>
                    <td>{{ utm.source }} / {{ utm.medium || 'direct' }}</td>
                    <td>{{ utm.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No campaign data yet</div>
          }
        </div>

        <div class="data-table-card">
          <h2>Key Interactions</h2>
          @if (stats()?.interactions?.length > 0) {
            <table class="data-table">
              <thead>
                <tr>
                  <th>Action</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                @for (item of stats()?.interactions; track item.name) {
                  <tr>
                    <td>{{ item.name }}</td>
                    <td>{{ item.count }}</td>
                  </tr>
                }
              </tbody>
            </table>
          } @else {
            <div class="empty-state">No interactions yet</div>
          }
        </div>
      </div>
    } @else if (activeTab() === 'projects') {
      @if (isFormOpen()) {
        <section class="project-form">
          <h3>{{ editingId() ? 'Edit Project' : 'New Project' }}</h3>
          <form [formGroup]="projectForm" (ngSubmit)="saveProject()">
            <div class="form-grid">
              <div class="form-group">
                <label>Title</label>
                <input formControlName="title" placeholder="Project title">
              </div>
              <div class="form-group">
                <label>Completed Date</label>
                <input formControlName="completedDate" placeholder="e.g. June 2024">
              </div>
              <div class="form-group">
                <label>Tags (comma separated)</label>
                <input formControlName="tags" placeholder="UI/UX, Angular, NestJS">
              </div>
              <div class="form-group">
                <label>Main Image URL</label>
                <div class="input-with-action">
                  <input formControlName="imageUrl" placeholder="assets/images/...">
                  <button type="button" (click)="openMediaPicker('imageUrl')" class="btn btn-outline btn-sm">Pick</button>
                </div>
              </div>
              <div class="form-group">
                <label>Company Logo URL</label>
                <div class="input-with-action">
                  <input formControlName="companyLogo" placeholder="assets/images/...">
                  <button type="button" (click)="openMediaPicker('companyLogo')" class="btn btn-outline btn-sm">Pick</button>
                </div>
              </div>
              <div class="form-group">
                <label>Mockup URL</label>
                <div class="input-with-action">
                  <input formControlName="mockupUrl" placeholder="assets/images/...">
                  <button type="button" (click)="openMediaPicker('mockupUrl')" class="btn btn-outline btn-sm">Pick</button>
                </div>
              </div>
              <div class="form-group">
                <label>Gallery (comma separated URLs)</label>
                <div class="input-with-action">
                  <input formControlName="gallery" placeholder="url1, url2, url3">
                  <button type="button" (click)="openMediaPicker('gallery')" class="btn btn-outline btn-sm">Pick</button>
                </div>
              </div>
              <div class="form-group" style="flex-direction: row; align-items: center; gap: 1rem; padding-top: 1.5rem;">
                <label style="margin: 0;">Featured Project</label>
                <input type="checkbox" formControlName="isFeatured" style="width: auto;">
              </div>
              <div class="form-group">
                <label>Display Order</label>
                <input type="number" formControlName="order">
              </div>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
              <label>Brief Description</label>
              <textarea formControlName="description" placeholder="A short summary of the project"></textarea>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
              <label>Challenge</label>
              <textarea formControlName="challenge"></textarea>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
              <label>Solution</label>
              <textarea formControlName="solution"></textarea>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
              <label>Result</label>
              <textarea formControlName="result"></textarea>
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
              <label>Full Content (Markdown/HTML supported)</label>
              <textarea formControlName="content" style="min-height: 200px;"></textarea>
            </div>

            <div class="form-actions">
              <button type="button" (click)="closeForm()" class="btn btn-secondary">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="projectForm.invalid">
                {{ editingId() ? 'Update Project' : 'Create Project' }}
              </button>
            </div>
          </form>
        </section>
      }

      <div class="projects-management data-table-card">
        <h2>Manage Projects</h2>
        @if (projects().length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Order</th>
                <th>Project Title</th>
                <th>Status</th>
                <th>Completed</th>
                <th>Tags</th>
                <th class="actions-cell">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (project of projects(); track project.id) {
                <tr>
                  <td>{{ project.order }}</td>
                  <td class="title-cell">
                    <strong>{{ project.title }}</strong>
                  </td>
                  <td>
                    @if (project.isFeatured) {
                      <span class="status-badge featured">Featured</span>
                    }
                  </td>
                  <td>{{ project.completedDate || 'N/A' }}</td>
                  <td>
                    <div class="mini-tags">
                      @if (project.tags) {
                        @for (tag of project.tags.slice(0, 2); track tag) {
                          <span class="mini-tag">{{ tag }}</span>
                        }
                        @if (project.tags.length > 2) {
                          <span class="mini-tag">+{{ project.tags.length - 2 }}</span>
                        }
                      } @else {
                        <span class="no-tags">No tags</span>
                      }
                    </div>
                  </td>
                  <td class="actions-cell">
                    <button (click)="openForm(project)" class="icon-btn edit" title="Edit">
                      <app-icon name="edit" [size]="16"></app-icon>
                    </button>
                    <button (click)='deleteProject(project.id)' class="icon-btn delete" title="Delete">
                      <app-icon name="trash" [size]="16"></app-icon>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No projects found</div>
        }
      </div>
    } @else if (activeTab() === 'messages') {
      <div class="messages-management data-table-card">
        <h2>Inquiry Messages</h2>
        @if (messages().length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>From</th>
                <th>Subject</th>
                <th>Message</th>
                <th class="actions-cell">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (msg of messages(); track msg.id) {
                <tr [class.unread]="!msg.isRead">
                  <td class="date-cell">{{ msg.createdAt | date:'MMM d, y' }}</td>
                  <td class="from-cell">
                    <strong>{{ msg.name }}</strong>
                    <br>
                    <small>{{ msg.email }}</small>
                  </td>
                  <td>{{ msg.subject || 'No Subject' }}</td>
                  <td class="message-preview-cell">
                    <div class="message-text">{{ msg.message }}</div>
                  </td>
                  <td class="actions-cell">
                    @if (!msg.isRead) {
                      <button (click)="markMessageAsRead(msg.id)" class="icon-btn success" title="Mark as read">
                        <app-icon name="check" [size]="16"></app-icon>
                      </button>
                    }
                    <button (click)="deleteMessage(msg.id)" class="icon-btn delete" title="Delete">
                      <app-icon name="trash" [size]="16"></app-icon>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No messages received yet</div>
        }
      </div>
    } @else if (activeTab() === 'settings') {
      <div class="settings-management data-table-card">
        <h2>Global Site Settings</h2>
        <form [formGroup]="settingsForm" (ngSubmit)="saveSettings()">
          <div class="form-section">
            <h3>Hero Section</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Site Title</label>
                <input formControlName="siteTitle">
              </div>
              <div class="form-group">
                <label>Hero Title</label>
                <input formControlName="heroTitle">
              </div>
              <div class="form-group">
                <label>Hero Subtitle</label>
                <input formControlName="heroSubtitle">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>About & Bio</h3>
            <div class="form-group" style="margin-bottom: 1rem;">
              <label>Bio Lead Paragraph</label>
              <textarea formControlName="bioLead"></textarea>
            </div>
            <div class="form-group">
              <label>Full Bio Content</label>
              <textarea formControlName="bioFull" style="min-height: 150px;"></textarea>
            </div>
          </div>

          <div class="form-section">
            <h3>Technical Skills (comma separated)</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Frontend Skills</label>
                <input formControlName="frontendSkills">
              </div>
              <div class="form-group">
                <label>Backend Skills</label>
                <input formControlName="backendSkills">
              </div>
              <div class="form-group">
                <label>Tools & DevOps</label>
                <input formControlName="toolSkills">
              </div>
            </div>
          </div>

          <div class="form-section">
            <h3>Social & Contact</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>GitHub URL</label>
                <input formControlName="githubUrl">
              </div>
              <div class="form-group">
                <label>LinkedIn URL</label>
                <input formControlName="linkedinUrl">
              </div>
              <div class="form-group">
                <label>Public Email</label>
                <input formControlName="email">
              </div>
            </div>
          </div>

          <div class="form-actions" style="margin-top: 2rem;">
            <button type="submit" class="btn btn-primary">Save All Settings</button>
          </div>
        </form>
      </div>
    } @else if (activeTab() === 'media') {
      <div class="media-management data-table-card">
        <h2>Asset Library</h2>
        @if (mediaList().length > 0) {
          <div class="media-grid">
            @for (item of mediaList(); track item.id) {
              <div class="media-item">
                <div class="media-preview">
                  <img [src]="'http://localhost:3000' + item.url" [alt]="item.originalName">
                  <div class="media-overlay">
                    <button (click)="deleteMediaAsset(item.id)" class="icon-btn delete" title="Delete">
                      <app-icon name="trash" [size]="16"></app-icon>
                    </button>
                  </div>
                </div>
                <div class="media-info">
                  <span class="media-name">{{ item.originalName }}</span>
                  <span class="media-meta">{{ (item.size / 1024).toFixed(1) }} KB</span>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="empty-state">No media assets uploaded yet</div>
        }
      </div>
    }
  </div>

  @if (isMediaPickerOpen()) {
    <div class="modal-overlay" (click)="closeMediaPicker()">
      <div class="modal-content media-picker-modal" (click)="$event.stopPropagation()">
        <header class="modal-header">
          <h3>Select Media</h3>
          <button (click)="closeMediaPicker()" class="icon-btn">
            <app-icon name="close" [size]="20"></app-icon>
          </button>
        </header>
        <div class="modal-body">
          @if (mediaList().length > 0) {
            <div class="media-grid picker">
              @for (item of mediaList(); track item.id) {
                <div class="media-item" (click)="selectMediaForProject(item.url)">
                  <div class="media-preview">
                    <img [src]="'http://localhost:3000' + item.url" [alt]="item.originalName">
                  </div>
                  <div class="media-info">
                    <span class="media-name">{{ item.originalName }}</span>
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-state">
              <p>No assets found.</p>
              <label class="btn btn-primary btn-sm" style="cursor: pointer; margin-top: 1rem;">
                Upload First
                <input type="file" (change)="onFileUpload($event)" style="display: none;" accept="image/*">
              </label>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
