<div class="dashboard-container fade-in-animation">
  <header class="dashboard-header">
    <div class="header-content">
      <h1>Analytics Dashboard</h1>
      <div class="header-actions">
        <button (click)="loadStats()" class="btn btn-outline btn-sm">Refresh</button>
        <button (click)="logout()" class="btn btn-outline btn-sm">Logout</button>
      </div>
    </div>
  </header>

  <div class="dashboard-content">
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Views</h3>
        <p class="stat-value">{{ stats()?.totalViews || 0 }}</p>
        <span class="stat-label">All time</span>
      </div>
      <div class="stat-card">
        <h3>Unique Visitors</h3>
        <p class="stat-value">{{ stats()?.uniqueVisitors || 0 }}</p>
        <span class="stat-label">All time</span>
      </div>
      <div class="stat-card">
        <h3>Recent Views</h3>
        <p class="stat-value">{{ stats()?.recentViews || 0 }}</p>
        <span class="stat-label">Last 24 hours</span>
      </div>
    </div>

    <div class="chart-section data-table-card">
      <h2>7-Day Activity</h2>
      @if (stats()?.dailyActivity?.length > 0) {
        <div class="bar-chart">
          @for (day of stats()?.dailyActivity; track day.date) {
            <div class="bar-group">
              <div class="bar-container">
                <div class="bar" 
                  [style.height.%]="(day.count / getMaxActivity()) * 100"
                  [attr.title]="day.count + ' views'">
                  <span class="bar-tooltip">{{ day.count }}</span>
                </div>
              </div>
              <span class="bar-label">{{ day.date }}</span>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">No activity data yet</div>
      }
    </div>

    <div class="stats-sections">
      <div class="data-table-card">
        <h2>Top Pages</h2>
        @if (stats()?.topPages?.length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Page Path</th>
                <th>Views</th>
              </tr>
            </thead>
            <tbody>
              @for (page of stats()?.topPages; track page.path) {
                <tr>
                  <td>{{ page.path }}</td>
                  <td>{{ page.count }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No page data yet</div>
        }
      </div>

      <div class="data-table-card">
        <h2>Top Referrers</h2>
        @if (stats()?.topReferrers?.length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Source</th>
                <th>Views</th>
              </tr>
            </thead>
            <tbody>
              @for (ref of stats()?.topReferrers; track ref.referrer) {
                <tr>
                  <td>{{ ref.referrer }}</td>
                  <td>{{ ref.count }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No referrer data yet</div>
        }
      </div>

      <div class="data-table-card">
        <h2>Browser Usage</h2>
        @if (stats()?.browsers?.length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Browser</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody>
              @for (browser of stats()?.browsers; track browser.name) {
                <tr>
                  <td>{{ browser.name }}</td>
                  <td>{{ browser.count }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No browser data yet</div>
        }
      </div>

      <div class="data-table-card">
        <h2>Key Interactions</h2>
        @if (stats()?.interactions?.length > 0) {
          <table class="data-table">
            <thead>
              <tr>
                <th>Action</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              @for (item of stats()?.interactions; track item.name) {
                <tr>
                  <td>{{ item.name }}</td>
                  <td>{{ item.count }}</td>
                </tr>
              }
            </tbody>
          </table>
        } @else {
          <div class="empty-state">No interactions yet</div>
        }
      </div>
    </div>
  </div>
</div>
